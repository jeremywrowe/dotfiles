#!/usr/bin/env ruby

require 'nokogiri'
require 'open-uri'

URL = 'http://www.trianglemtb.com'.freeze
INTERESTING_TRAILS = ['Brumley Forest', 'Crabtree', 'San Lee Gravity Park', 'San Lee Singletrack'].freeze
MAPPING = {
  'Brumley Forest'       => 'Brumley',
  'Crabtree'             => 'Crabtree',
  'San Lee Gravity Park' => 'SL Gravity',
  'San Lee Singletrack'  => 'SL Single'
}.freeze

document = Nokogiri::HTML(open(URL))
rows = document.css('html body table td table tr')
rows.shift

filtered_rows = rows.reject do |row|
  name = row.css('td')[0].text.to_s.strip
  INTERESTING_TRAILS.index(name).nil?
end

trails = filtered_rows.map do |tr|
  name, status, _rest = tr.css('td')
  striped_status = status.text.strip == 'OPEN' ? 'âœ…' : 'ðŸ’”'
  "#{MAPPING[name.text.strip]} #{striped_status}"
end

puts trails.join(' | ')

